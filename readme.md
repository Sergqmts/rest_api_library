# Проект "Библиотечная система"

Данный проект представляет собой API для управления библиотекой, включающий регистрацию пользователей, добавление книг, учет читателей, выдачу и возврат книг, а также систему аутентификации с использованием JWT-токенов. API реализован с помощью FastAPI и SQLAlchemy, что обеспечивает высокую производительность и удобство расширения.

## Инструкция по запуску

Предварительные требования
- Python 3.8+
- Установленные зависимости из файла requirements.txt (или команда pip install -r requirements.txt)
- База данных (например, SQLite по умолчанию)


## Шаги запуска
Клонируйте репозиторий:
```sh
git clone <ваш_репозиторий>
cd <путь_к_проекту>
```

Установите зависимости:
```sh
pip install -r requirements.txt
```

Создайте базу данных и выполните миграции (если используете Alembic или вручную создаете таблицы):
```python
# Например, для SQLite:
alembic upgrade head
# или вручную:
from app.models import Base, engine
Base.metadata.create_all(bind=engine)
```

Запустите сервер:
```sh
uvicorn app.main:app --reload
```

Регистрация первого пользователя
Для регистрации первого пользователя отправьте POST-запрос на /register с JSON:

```json
{
  "email": "admin@example.com",
  "password": "your_secure_password"
}
```
После этого выполните вход по тому же email и паролю на /login, чтобы получить токен доступа.

## Структура проекта
- app/
    - /models.py — определения ORM-моделей базы данных.
    - /schemas.py — Pydantic модели для валидации входных и выходных данных.
    - /main.py — точка входа, маршруты API.
    - /config - конфигурациz для работы с базой данных с использованием SQLAlchemy.
    - /auth - cодержит модуль для работы с аутентификацией
    - /crud -содержит CRUD-операции для работы с сущностью "Reader"
    - /dependencies - содержит зависимости для FastAPI, необходимые для работы с базой данных и аутентификацией:
- tests/
    - /test.py — предназначен для проверки регистрации и входа пользователя.
- requirements.txt — список зависимостей.


## Структура базы данных и принятые решения

- База данных содержит следующие таблицы:
    - users: хранит информацию о зарегистрированных пользователях (библиотекарях).
    - books: информация о книгах (заголовок, автор, год публикации, ISBN, количество экземпляров).
    - readers: данные о читателях библиотеки.
    - borrowed_books: учет выданных книг с датами выдачи и возврата.
    -loans: альтернативная таблица для учета займов (может использоваться для расширения функционала).


## Решения по структуре:

Использование внешних ключей для связей между таблицами.
Поля quantity в таблице книг позволяют отслеживать доступное количество экземпляров.
В таблицах borrowed_books и loans реализована история выдач/займов.
## Бизнес-логика
### 4.1 Регистрация пользователей
Пользователи регистрируются через эндпоинт /register. Пароль хэшируется перед сохранением (используется bcrypt или аналогичная библиотека). После регистрации пользователь может авторизоваться через /login, получая JWT-токен.

### 4.2 Добавление книг и читателей
Только авторизованные пользователи могут добавлять книги (/books) и регистрировать новых читателей (/readers). Это реализовано через защиту эндпоинтов зависимостью от токена.

### 4.3 Выдача и возврат книг
Выдача книги (/borrow) создает запись в borrowed_books, уменьшает доступное количество экземпляров книги. Возврат (/return) обновляет запись и увеличивает количество доступных экземпляров.

Сложности: Обеспечить целостность данных при одновременных операциях было решено с помощью транзакций SQLAlchemy. Также реализована проверка наличия доступных экземпляров перед выдачей.

## Аутентификация
Реализация токенов JWT
Токены генерируются при входе (/login) с помощью библиотеки PyJWT.
Токены содержат идентификатор пользователя (user_id) в payload.
Проверка токена осуществляется через зависимость FastAPI (Depends) на защищенных маршрутах.
Защищенные эндпоинты
Все операции по управлению книгами, читателями, выдачами требуют наличия валидного JWT-токена в заголовке Authorization (Bearer <token>).

## Используемые библиотеки
- FastAPI — основной фреймворк для API.
- SQLAlchemy — ORM для работы с базой данных.
- PyJWT — создание и проверка JWT-токенов.
- passlib — хэширование паролей.
Эти библиотеки выбраны за их популярность, надежность и простоту интеграции.

## Творческая часть: Предложение новой функции
Я бы предложил реализовать систему уведомлений о просроченных возвратах книг.
